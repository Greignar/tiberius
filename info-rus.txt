Краткий обзор прошивки - https://youtu.be/k0na8clMZmw

Обратите внимание, при первом включении необходима инициализация прошивки. Делается это следующим образом: включаете фонарь, делаете 9 кликов и входите в режим настройки, после этого делаете еще 9 кликов и выключаете фонарь.

Особенности прошивки:

Никаких переделок драйвера, кроме освобождения ножки контроллера, с помощью которой производитель сделал защиту от смены прошивки.

После прошивки и сброса фонарь имеет следующие режимы яркости: 2%, 5%, 14%, 37%, 100%. Фонарь стартует всегда с режима 14%. Одиночный клик переключает режимы в порядке: 14%, 37%, 100%, 14% и т.д. Режимы 2% и 5% доступны только по двойному клику.

Полностью настраиваемая яркость на пяти режимах с возможностью изменения количества режимов от одного до пяти. Возможность быстрого переключения в максимальный и минимальный уровни яркости. Индикация заряда аккумулятора. Защита от разряда аккумулятора. Защита от перегрева (по времени). Режим SOS.

В режиме выборочной настройки доступны следующие уровни (шаги) яркости: 0%, 2%, 5%, 14%, 37%, 100%.

Защита от разряда аккумулятора: ограничение максимальной яркости до 14% при снижении заряда аккумулятора менее 3.2 вольт, снижение яркости до 5% (с периодом 5 секунд за 1 шаг снижения яркости) при заряде аккумулятора менее 3.0 вольт, полное выключение фонаря при заряде аккумулятора менее 2.8 вольт.

Защита от перегрева и преждевременного разряда аккумулятора (кроме режима SOS): снижение яркости до 37% от максимальной (с периодом в 3 минуты).

Все вышеуказанные снижения яркости сбрасываются одинарным кликом.

Сигналы SOS посылаются с периодом в одну минуту. Яркость режима SOS - 37%. Относительное потребление энергии в режиме SOS - 1.85% от максимального потребления. В режиме SOS не действуют защиты от разряда и перегрева.

Фонарь имеет два основных режима: обычный режим и режим настройки. В режим настройки можно войти 9 кликами из нормального режима, а выйти - выключением фонаря.

Обычный режим

Клик 1: Следующий режим яркости (по кругу, начиная с режима "Клик 4" режима выборочной настройки)
Клик 2: Предыдущий режим яркости (только вниз)
Клик 3: Максимальная яркость
Клик 4: Минимальная яркость
Клик 5: Уровень заряда аккумулятора
Клик 6: Режим SOS
Клик 9: Режим настройки

Режим настройки

Клик 1: Следующий режим яркости (по кругу, начиная с режима "Клик 4" режима выборочной настройки)
Клик 2: Предыдущий режим яркости (только вниз)
Клик 3: Установка уровней яркости (для всех пяти режимов)
Клик 4: Установка начального уровня яркости (для режима "Клик 1")
Клик 9: Сброс к исходному состоянию

Установка уровней яркости осуществляется в два прохода. Первый проход - перебор режимов с первого по пятый. После клика осуществляется перебор уровней яркости от яркости предыдущего режима до девятого уровня яркости. После клика уровень яркости сохраняется. Эту операцию можно повторить для всех пяти режимов. Уровень яркости 0 (0%) игнорируется, т.е. установив уровень яркости для первых двух режимов в 0 вы получите фонарь с тремя режимами. Максимальный режим яркости (100%) завершает группу, т.е. установив уровень яркости для третьего режима в 100% вы получите фонарь с тремя режимами.

Уровень яркости выбирается визуально, пользователь видит необходимый ему уровень яркости и фиксирует его одинарным кликом.

Данные в EEPROM пишутся только в режиме настройки.

Прошивка устанавливается командой:
avrdude -c usbasp -p t13 -u -Uflash:w:tiberius.hex -Ulfuse:w:0x75:m -Uhfuse:w:0xFD:m
